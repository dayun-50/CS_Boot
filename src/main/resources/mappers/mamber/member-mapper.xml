<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- 사원 회원가입 등등 -->
  
  <mapper namespace="Member">
  
  	<insert id="insert">
  		insert into member values (#{email}, '7', '7', #{pw}, #{name}, #{phone}, #{company_code}, sysdate, '승인')
  	</insert>
  	<select id="getDomainByEmail" parameterType="String" resultType="String">
    select c.domain_name from member m join company c on m.company_code = c.company_code 
	where m.email = #{email}
	</select>
  	<select id="getDomainByCompanyCode" parameterType="String" resultType="String">
    SELECT domain_name
    FROM company
    WHERE company_code = #{companyCode}
	</select>
  
  	<select id="selectByLogin" resultType="Integer"  parameterType="com.kedu.project.members.member.MemberDTO">
  		select count(*) from member where email = #{email} and pw = #{pw}
  	</select>
  	
  	<select id="selectById" resultType="Integer"  parameterType="com.kedu.project.members.member.MemberDTO">
  		select count(*) from member where email = #{email}
  	</select>

  	<update id="updateByGnewpw">
  		update member set pw = #{pw} where email = #{email}
  	</update>
  	
  	<select id="selectByMypage" resultType="com.kedu.project.members.member.MemberDTO" parameterType="com.kedu.project.members.member.MemberDTO">
  		SELECT 
   			m.email,
    		m.name,
    		d.dept_name AS dept_code,
    		j.level_name AS level_code,
    		m.phone
		FROM member m JOIN department d 
			ON m.dept_code = d.dept_code AND m.company_code = d.company_code
			JOIN job_level j 
    		ON m.level_code = j.level_code
    		AND m.company_code = j.company_code
		WHERE m.email = #{email}
  	</select>
  	
  	<update id="updateMypage">
  		update member set name = #{name}, phone = #{phone} where email = #{email}
  	</update>

  	<select id="memberSearch" resultType="com.kedu.project.members.member.MemberDTO">
  		SELECT 
  			m.email,
		    m.name,
		    j.level_name as level_code
		FROM member m
		JOIN job_level j
		    ON m.level_code = j.level_code
		WHERE m.dept_code = (
		    SELECT dept_code
		    FROM member
		    WHERE email = #{email}
		)
		AND m.email != #{email}
  	</select>
  	
  	<select id="selectDepartment" resultType="String">
  		SELECT d.dept_name as dept_code
		FROM member m
		JOIN department d
		    ON m.dept_code = d.dept_code
		WHERE m.email = #{email}
  	</select>
  	
  	<select id="selectMemberName" resultType="String">
  		select name from member where email = #{member_email}
  	</select>
  	
  	<select id="checkMember" resultType="int">
  		select count(*) from member where email = #{email}
  	</select>
  	
  	<!-- 아래는 지원 사용:입사일 기준 연차 지급용으로 필요 -->
	<!-- 모든 멤버 뽑아오기 -->
  	<select id="selectAll" resultType="com.kedu.project.members.member.MemberDTO">
  		select * from member
  	</select>
  	<!-- 아이디로 디티오 뽑아오기-->
  	  <select id="findByEmail" resultType="com.kedu.project.members.member.MemberDTO">
  		select * from member where email=#{email}
  	</select> 
  	
  	<!-- 주소록에 좀 쓸게  -->
  	<select id="getDeptCodeByEmail" resultType="String" parameterType="String">
        SELECT DEPT_CODE FROM member WHERE EMAIL = #{email}
    </select>
    
    <select id="getCompanyCodeEmail" resultType="String">
        SELECT 	COMPANY_CODE FROM member WHERE EMAIL = #{email}
    </select>

	<select id="selectMemberCompany" resultType="String">
		select company_code from member where email = #{email}
	</select>

  </mapper>